var lderror,dollm,ref$;function import$(e,t){var r,n={}.hasOwnProperty;for(r in t)n.call(t,r)&&(e[r]=t[r]);return e}lderror={reject:function(){return Promise.reject(e)}},(dollm={thread:function(e){return this._={name:(e=null==e?{}:e).name||"general chatbot",stateless:e.stateless||!1,id:e.id||("undefined"!=typeof suuid&&null!==suuid?suuid():Math.random().toString(36).substring(2)),proc:e.proc||function(){},opt:e.opt||{},url:e.url||"",model:e.model||""},this.messages=[{role:"system",content:e.system||"you are a general chatbot."}],this}}).thread.prototype=((ref$=Object.create(Object.prototype)).name=function(){return this._.name||"general chatbot"},ref$.model=function(){return this._.model||"default model"},ref$.send=function(e){var t,r=this,n=e.message,e=e.proc;return this.messages.push({role:"user",content:n}),this._send(((n={messages:this.messages}).model=(t=this._).model,n.opt=t.opt,n.url=t.url,(t=n).proc=e||this._.proc||function(){},t)).then(function(e){return r._.stateless?r.messages.pop():r.messages.push({role:"assistant",content:e.buf}),e})},ref$._send=function(e){var t=e.messages,a=e.proc,r=e.model,n=e.opt,e=e.url;return n=n||{},e=e||"http://localhost:11434/api/chat",this._.controller||(this._.controller=new AbortController),n={method:"POST",headers:import$({"Content-Type":"application/json"},(n||{}).headers||{}),body:JSON.stringify({model:r||"gemma2:9b",messages:t||[]}),signal:this._.controller.signal},fetch(e,n).then(function(e){var t=e.body.getReader(),r=new TextDecoder,n={buf:""},o=function(e){e=(e=null==e?{}:e).message&&"assistant"===e.message.role?e.message.content||"":e.response||"";return a(e)},s=function(){return t.read().then(function(e){var t=e.done,e=e.value;if(t){if(n.buf.trim())try{o(JSON.parse(buf))}catch(e){lderror.reject(e)}return Promise.resolve(n)}return n.buf+=r.decode(e,{stream:!0}),t=n.buf.split("\n"),n.buf=t.pop(),t.forEach(function(e){if(e.trim())try{return o(JSON.parse(e))}catch(e){return lderror.reject(e)}}),s()})};return s()})},ref$.abort=function(){if(this._.controller)return this._.controller.abort(),this._.controller=null},ref$);