var thread;console.log("[infoext] background script run"),importScripts("dollm.js"),thread={summarizer:new dollm.thread({name:"Phi-4 測試機",model:"phi4:14b",stateless:!0,system:"你是一個文本摘要工具。用戶傳給你的文本，你會透過正體中文回覆其摘要過後的內容。"}),generator:new dollm.thread({name:"內容生成器",model:"phi4:14b",stateless:!0,system:"你是一個文本生成工具，幫用戶生成輸入框中的文字。為了提示你情境，用戶會傳給你兩段文字，第一段是輸入框之前的文字、第二段則是輸入框之後的文字，你可依這兩組文字隨機生成適合置於此輸入框中的文字。\n\n用戶亦會告訴你需要填入的元素是 input, textarea 或其它可能的元素名; input 需要較短的回應內容 (20 字內), textarea 則可以長一些 (50 ~ 300 字不等), 其它情況你可以自行衡量。\n\n請注意，用戶提供的前後文可能包含無關的訊息，因為那是用程式自動節錄的。你應該要自行判斷跟前後文最可能相關的輸入框內容，以前文來說就是最後面的文字、以後文來說就是最前面的文字，但前文的結尾會比後文的開頭還要重要。\n\n你會透過正體中文回覆。"})},chrome.runtime.onInstalled.addListener(function(){return chrome.contextMenus.create({id:"summarize-selection",title:"Summarize ...",contexts:["selection"]}),chrome.contextMenus.create({id:"generate-placeholder-text",title:"Generate ...",contexts:["editable"]})}),chrome.contextMenus.onClicked.addListener(function(e,t){var n,r;"summarize-selection"===e.menuItemId?(n=e.selectionText)&&(r=Math.random().toString(36).substring(2),console.log("[session "+r+"] start to summarize text ( "+n.length+" bytes )"),chrome.tabs.sendMessage(t.id,{action:"summarize-start",session:r}),thread.summarizer.send({message:n,proc:function(e){try{return chrome.tabs.sendMessage(t.id,{action:"summarize-char",session:r,char:e}).then(function(e){if((e=null==e?{}:e).abort)return thread.summarizer.abort()})}catch(e){return console.error(e),thread.summarizer.abort()}}})):"generate-placeholder-text"===e.menuItemId&&(r=Math.random().toString(36).substring(2),console.log("[session "+r+"] generate placeholder text"),chrome.tabs.sendMessage(t.id,{action:"input-context",session:r}).then(function(e){return console.log(e),thread.generator.send({message:"元素類型："+e.type+"\n\n第一段文字：\n--------------------------\n"+e.before+"\n--------------------------\n第二段文字：\n--------------------------\n"+e.after,proc:function(e){try{return chrome.tabs.sendMessage(t.id,{action:"generate-char",session:r,char:e}).then(function(e){if((e=null==e?{}:e).abort)return thread.generator.abort()})}catch(e){return console.error(e),thread.generator.abort()}}})}))});