var bubble,ref$,bubbles,inputs,getContext;console.log("[infoext] content script run"),(bubble=function(e){var t,n,o=this;return this.session=(e=null==e?{}:e).session,n=(t=(e=0<(e=window.getSelection()).rangeCount?[(e=e.getRangeAt(0).getBoundingClientRect()).left+window.scrollX,e.top+window.scrollY]:[32+window.scrollX,32+window.scrollY])[0],e[1]),t+432>window.innerWidth&&(t=window.innerWidth-432),this.node=document.createElement("div"),(e=this.node.style).position="absolute",e.padding="1em",e.whiteSpace="pre-wrap",e.borderRadius=".5em",e.border="1px solid #d6d7d8",e.boxShadow="0 2px 4px rgba(0,0,0,.3)",e.background="#fff",e.top=n+"px",e.left=t+"px",e.width="400px",e.opacity=".85",this.node.textContent="loading...",this.node.addEventListener("click",function(){return o.node.style.display="none",bubbles[o.session]=null}),this.txt="",document.body.appendChild(this.node),this}).prototype=((ref$=Object.create(Object.prototype)).write=function(e){return this.node.textContent=this.txt+=e},ref$),bubbles={},inputs={},chrome.runtime.onMessage.addListener(function(e,t,n){var o;return"summarize-start"===e.action?bubbles[e.session]={bubble:new bubble({session:e.session})}:"summarize-char"===e.action?(o=(bubbles[e.session]||{}).bubble)?(o.write(e.char),n()):n({abort:!0}):"input-context"!==e.action?(e.action="generate-char",(o=(inputs[e.session]||{}).node)?(o.value+=e.char,n()):n({abort:!0})):(o=document.activeElement,/textarea|input/gi.exec(o.tagName)?(inputs[e.session]={node:o,session:e.session},o._session=e.session,o.value="",n(getContext(o))):void 0)}),document.addEventListener("click",function(e){if((e=e.target)&&e._session)return inputs[e._session]=null}),getContext=function(e){var t=document.createRange(),n=t.cloneRange(),t=t.cloneRange();return n.setStart(document.body,0),n.setEnd(e,0),t.setStart(e,0),t.setEndAfter(document.body.lastChild),{before:n.toString().slice(-20),after:t.toString().slice(0,20),type:e.tagName.toLowerCase()}};